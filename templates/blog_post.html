{% extends "base.html" %}

{% block title %}{{ post.title }} - {{ translations[lang]['site_title'] }}{% endblock %}
{% block description %}{{ post.excerpt }}{% endblock %}

{% block extra_head %}
<!-- Syntax highlighting for code blocks -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<!-- MathJax for mathematical expressions -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-lg-4">
            <div class="sticky-top" style="top: 100px;">
                <!-- Table of Contents -->
                <div class="card mb-4" id="toc-card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-list me-2"></i>Table of Contents
                        </h5>
                    </div>
                    <div class="card-body" id="toc-content">
                        <!-- TOC will be generated by JavaScript -->
                    </div>
                </div>

                <!-- Post Info -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-info-circle me-2"></i>Post Info
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-2">
                            <small class="text-muted d-block">Published</small>
                            <strong>{{ post.date.strftime('%B %d, %Y') }}</strong>
                        </div>
                        <div class="mb-2">
                            <small class="text-muted d-block">Reading Time</small>
                            <strong>{{ post.reading_time }} minutes</strong>
                        </div>
                        <div class="mb-2">
                            <small class="text-muted d-block">Author</small>
                            <strong>{{ post.author }}</strong>
                        </div>
                        {% if post.tags %}
                        <div class="mb-2">
                            <small class="text-muted d-block">Tags</small>
                            {% for tag in post.tags %}
                            <a href="/{{ lang }}/blog?tag={{ tag }}" class="badge bg-light text-dark text-decoration-none me-1">{{ tag }}</a>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Related Posts -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-bookmark me-2"></i>Related Posts
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted small">More posts coming soon!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-lg-8">
            <article>
                <!-- Header -->
                <header class="mb-5">
                    <h1 class="display-5 fw-bold mb-3">{{ post.title }}</h1>
                    
                    <div class="blog-meta mb-4">
                        <div class="d-flex flex-wrap align-items-center">
                            <span class="me-4">
                                <i class="fas fa-calendar-alt me-1"></i>
                                {{ post.date.strftime('%B %d, %Y') }}
                            </span>
                            <span class="me-4">
                                <i class="fas fa-clock me-1"></i>
                                {{ post.reading_time }} min read
                            </span>
                            <span class="me-4">
                                <i class="fas fa-user me-1"></i>
                                {{ post.author }}
                            </span>
                        </div>
                    </div>
                    
                    {% if post.tags %}
                    <div class="mb-4">
                        {% for tag in post.tags %}
                        <a href="/{{ lang }}/blog?tag={{ tag }}" class="badge bg-primary me-1 text-decoration-none">{{ tag }}</a>
                        {% endfor %}
                    </div>
                    {% endif %}
                </header>

                <!-- Content -->
                <div class="blog-content">
                    {{ post.html_content | safe }}
                </div>

                <!-- Share buttons -->
                <div class="mt-5 pt-4 border-top">
                    <h5 class="mb-3">Share this post</h5>
                    <div class="d-flex gap-2">
                        <a href="https://twitter.com/intent/tweet?text={{ post.title }}&url={{ request.url }}" 
                           class="btn btn-outline-primary btn-sm" target="_blank">
                            <i class="fab fa-twitter me-1"></i>Twitter
                        </a>
                        <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.url }}" 
                           class="btn btn-outline-primary btn-sm" target="_blank">
                            <i class="fab fa-linkedin me-1"></i>LinkedIn
                        </a>
                        <a href="mailto:?subject={{ post.title }}&body=Check out this blog post: {{ request.url }}" 
                           class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-envelope me-1"></i>Email
                        </a>
                    </div>
                </div>
            </article>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Initialize syntax highlighting
hljs.highlightAll();

// Generate table of contents
document.addEventListener('DOMContentLoaded', function() {
    const content = document.querySelector('.blog-content');
    const toc = document.getElementById('toc');
    const headings = content.querySelectorAll('h1, h2, h3, h4, h5, h6');
    
    if (headings.length > 1) {
        let tocHTML = '<ul class="list-unstyled">';
        headings.forEach((heading, index) => {
            const id = `heading-${index}`;
            heading.id = id;
            const level = parseInt(heading.tagName.charAt(1));
            const indent = level > 2 ? 'ms-3' : '';
            tocHTML += `<li class="${indent}"><a href="#${id}" class="text-decoration-none">${heading.textContent}</a></li>`;
        });
        tocHTML += '</ul>';
        toc.innerHTML = tocHTML;
    } else {
        toc.innerHTML = '<p class="text-muted small">No headings found</p>';
    }
    
    // Smooth scrolling for TOC links
    toc.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
});

// Copy code blocks to clipboard
document.querySelectorAll('pre code').forEach((block) => {
    const button = document.createElement('button');
    button.className = 'btn btn-sm btn-outline-secondary copy-btn';
    button.innerHTML = '<i class="fas fa-copy"></i>';
    button.style.position = 'absolute';
    button.style.top = '10px';
    button.style.right = '10px';
    
    const pre = block.parentNode;
    pre.style.position = 'relative';
    pre.appendChild(button);
    
    button.addEventListener('click', () => {
        copyToClipboard(block.textContent);
        button.innerHTML = '<i class="fas fa-check text-success"></i>';
        setTimeout(() => {
            button.innerHTML = '<i class="fas fa-copy"></i>';
        }, 2000);
    });
});
</script>
{% endblock %}